/**
 * LS Retail Cookie Banner Enhancer - Option A Implementation
 * @version 1.0.3 - Custom banner with HubSpot integration
 * @description Complete custom cookie banner that replaces HubSpot's default banner
 */
!function(){"use strict";const CONFIG={portalId:"491011",hubdbTableId:"130537251",apiEndpoint:"/hubdb/api/v2/tables",cacheVersion:"2025-08-26",verifyMode:window.location.search.includes("verify=true"),selectors:{banner:'[id*="hs-eu-cookie-confirmation"], [class*="cookie"], .hs-eu-cookie-confirmation-inner',settingsButton:'[data-cookieconsent="show-preferencecenter"]',policyWording:".hs-eu-policy-wording, .cookie-policy-text"},animations:{duration:300,easing:"ease-in-out"}},Utils={log(...args){CONFIG.verifyMode&&console.log("[LS Retail Option A]",...args)},error(...args){console.error("[LS Retail Option A]",...args)},parseConsentCookie(){try{const cookie=document.cookie.split(";").find(c=>c.trim().startsWith("__hs_cookie_cat_pref="));return cookie?JSON.parse(decodeURIComponent(cookie.split("=")[1])):{}}catch(e){return{}}}},HubDBIntegration={cache:null,cacheTimestamp:null,async loadData(){if(this.cache&&this.cacheTimestamp&&Date.now()-this.cacheTimestamp<6e5)return Utils.log("Using cached cookie data"),this.cache;Utils.log("Loading cookie data from HubDB...");try{const data=await this.loadFromHubDB();return data&&data.length>0?(this.cache=data,this.cacheTimestamp=Date.now(),Utils.log(`Loaded ${data.length} cookies from HubDB`),data):(Utils.log("No data from HubDB, falling back to embedded data"),this.loadEmbeddedData())}catch(error){return Utils.error("HubDB failed:",error),Utils.log("Falling back to embedded data"),this.loadEmbeddedData()}},async loadFromHubDB(){const controller=new AbortController,timeoutId=setTimeout(()=>controller.abort(),2e3);try{const response=await fetch(`${CONFIG.apiEndpoint}/${CONFIG.hubdbTableId}/rows?state=PUBLISHED`,{signal:controller.signal,headers:{"Content-Type":"application/json"}});if(clearTimeout(timeoutId),!response.ok)throw new Error(`HTTP ${response.status}`);const result=await response.json();return result.objects||result.results||[]}catch(error){throw clearTimeout(timeoutId),error.name==="AbortError"?new Error("Request timeout"):error}},loadEmbeddedData(){return Utils.log("Using embedded cookie data (54 cookies)"),[{values:{category_key:"1",cookie_name:"__hs_cookie_cat_pref",purpose:"HubSpot Cookie Preferences",duration:"6 months",description:"Stores visitor cookie consent preferences",provider:"HubSpot"}},{values:{category_key:"2",cookie_name:"_ga",purpose:"Google Analytics - Performance tracking",duration:"2 years",description:"Used to distinguish users and track website interactions for analytics",provider:"Google Analytics"}}]}},HubSpotAPI={initialized:!1,originalSettingsHandler:null,init(){this.initialized||(window.disableHubSpotCookieBanner=!0,Utils.log("Initializing HubSpot API integration"),typeof window._hsp>"u"?(Utils.log("HubSpot API not found, running in mock mode"),this.initMockAPI()):(Utils.log("Connected to LS Retail HubSpot portal 491011"),this.initRealAPI()),this.initialized=!0)},initRealAPI(){window._hsp=window._hsp||[],window._hsp.push(["addPrivacyConsentListener",consent=>{Utils.log("Privacy consent updated:",consent)}])},initMockAPI(){window._hsp={mockConsent:{categories:{"1":!0,"2":!0,"3":!1,"4":!1}},push:function(args){const[method,callback]=args;"addPrivacyConsentListener"===method?window._hsp.consentListener=callback:"getPrivacyConsentState"===method?setTimeout(()=>callback(window._hsp.mockConsent),10):"updatePrivacyConsent"===method&&(window._hsp.mockConsent=Object.assign({},window._hsp.mockConsent,args[1]),window._hsp.consentListener&&window._hsp.consentListener(window._hsp.mockConsent),Utils.log("Mock consent updated:",window._hsp.mockConsent))}}},setConsent(consent){if(Utils.log("Setting consent:",consent),window._hsp&&window._hsp.push){const categories={analytics:consent.analytics||!1,advertisement:consent.advertisement||!1,functionality:!1!==consent.functionality};window._hsp.push(["updatePrivacyConsent",{categories}]),Utils.log("Consent updated via HubSpot API")}else Utils.log("HubSpot API not available, using mock consent"),window._hsp&&window._hsp.mockConsent&&(window._hsp.mockConsent.categories=consent)},updateConsent(categoryKey,enabled){const consent=Utils.parseConsentCookie();consent[categoryKey]=enabled,window._hsp&&window._hsp.push&&(window._hsp.push(["updatePrivacyConsent",consent]),Utils.log("Updating consent for category",categoryKey,"to",enabled))}},OptionAEnhancer={banner:null,categoryContainer:null,cookieData:null,isExpanded:!1,currentConsent:{},async init(){Utils.log("Initializing LS Retail Option A Cookie Enhancer"),this.banner=this.createCustomBanner(),this.banner?(Utils.log("Created LS Retail custom banner"),HubSpotAPI.init(),this.cookieData=await HubDBIntegration.loadData(),Utils.log("Cookie data loaded:",this.cookieData),CONFIG.verifyMode&&this.showVerifyBadge(),this.currentConsent=Utils.parseConsentCookie(),Utils.log("LS Retail Option A initialized successfully")):(Utils.error("Failed to create LS Retail custom banner"),undefined)},createCustomBanner(){Utils.log("Creating custom LS Retail cookie banner");const banner=document.createElement("div");banner.id="ls-retail-custom-cookie-banner",banner.className="ls-custom-banner",banner.style.cssText=`
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: #f5a623;
                color: #333;
                padding: 20px;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
                line-height: 1.5;
            `,banner.innerHTML=`
                <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <p style="margin: 0; font-size: 14px;">
                            This website uses cookies to function properly and, with your consent, to collect data for analytics and 
                            personalized content. Essential cookies are always active. You can choose which types of optional cookies to 
                            allow by selecting "Learn more" below. See also our 
                            <a href="/privacy-policy" style="color: #333; text-decoration: underline;">Privacy Policy</a> 
                            for details and any questions.
                        </p>
                        <p style="margin: 8px 0 0 0; font-size: 12px; opacity: 0.8;">
                            If you decline, your information won't be tracked when you visit this website. A single cookie will be used in your 
                            browser to remember your preference not to be tracked.
                        </p>
                    </div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button id="ls-cookie-settings" style="
                            background: transparent; 
                            border: 2px solid #333; 
                            color: #333; 
                            padding: 8px 16px; 
                            border-radius: 4px; 
                            cursor: pointer; 
                            font-size: 14px; 
                            font-weight: 500;
                        ">Learn more</button>
                        <button id="ls-accept-all" style="
                            background: #333; 
                            border: 2px solid #333; 
                            color: white; 
                            padding: 8px 16px; 
                            border-radius: 4px; 
                            cursor: pointer; 
                            font-size: 14px; 
                            font-weight: 500;
                        ">Accept all</button>
                        <button id="ls-decline" style="
                            background: transparent; 
                            border: 2px solid #333; 
                            color: #333; 
                            padding: 8px 16px; 
                            border-radius: 4px; 
                            cursor: pointer; 
                            font-size: 14px; 
                            font-weight: 500;
                        ">Decline</button>
                    </div>
                </div>
            `;document.body.appendChild(banner);const learnMoreBtn=banner.querySelector("#ls-cookie-settings"),acceptBtn=banner.querySelector("#ls-accept-all"),declineBtn=banner.querySelector("#ls-decline");return learnMoreBtn.addEventListener("click",()=>this.toggleCategoryOptions()),acceptBtn.addEventListener("click",()=>this.acceptAllCookies()),declineBtn.addEventListener("click",()=>this.declineAllCookies()),Utils.log("Custom banner created and added to page"),banner},acceptAllCookies(){Utils.log("Accepting all cookies"),HubSpotAPI.setConsent({analytics:!0,advertisement:!0,functionality:!0}),this.hideBanner()},declineAllCookies(){Utils.log("Declining all cookies"),HubSpotAPI.setConsent({analytics:!1,advertisement:!1,functionality:!0}),this.hideBanner()},hideBanner(){this.banner&&(this.banner.style.display="none")},toggleCategoryOptions(){this.isExpanded?this.hideCategoryOptions():this.showCategoryOptions()},showCategoryOptions(){if(Utils.log("Showing category options"),this.categoryContainer||this.createCategoryContainer(),this.banner&&!this.categoryContainer.parentNode){const policySection=this.banner.querySelector("div > div:first-child");policySection&&policySection.appendChild(this.categoryContainer)}this.categoryContainer.style.display="block",this.categoryContainer.style.opacity="0",setTimeout(()=>{this.categoryContainer.style.transition=`opacity ${CONFIG.animations.duration}ms ${CONFIG.animations.easing}`,this.categoryContainer.style.opacity="1"},10),this.isExpanded=!0},hideCategoryOptions(){this.categoryContainer&&(Utils.log("Hiding category options"),this.categoryContainer.style.transition=`opacity ${CONFIG.animations.duration}ms ${CONFIG.animations.easing}`,this.categoryContainer.style.opacity="0",setTimeout(()=>{this.categoryContainer.style.display="none"},CONFIG.animations.duration),this.isExpanded=!1)},createCategoryContainer(){Utils.log("Creating category container");const container=document.createElement("div");container.className="ls-category-container",container.style.cssText=`
                margin-top: 15px;
                padding: 15px;
                background: rgba(255,255,255,0.1);
                border-radius: 4px;
                border: 1px solid rgba(51,51,51,0.2);
            `,container.setAttribute("role","region"),container.setAttribute("aria-label","Cookie categories and preferences");const title=document.createElement("h3");title.textContent="Cookie Categories",title.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",container.appendChild(title);const categories=this.getCategoriesFromData();categories.forEach(category=>{const categoryEl=this.createCategoryElement(category);container.appendChild(categoryEl)});const buttonContainer=document.createElement("div");buttonContainer.style.cssText="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;";const saveButton=document.createElement("button");saveButton.textContent="Save preferences",saveButton.style.cssText=`
                background: #333;
                border: none;
                color: white;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
            `,saveButton.addEventListener("click",()=>this.savePreferences()),buttonContainer.appendChild(saveButton),container.appendChild(buttonContainer),this.categoryContainer=container,Utils.log("Category container created")},getCategoriesFromData(){return[{id:"analytics",key:"2",title:"Analytics Cookies",description:"These cookies help us understand how visitors interact with our website by collecting and reporting information anonymously.",required:!1},{id:"marketing",key:"3",title:"Marketing Cookies",description:"These cookies are used to track visitors across websites to display relevant advertisements.",required:!1},{id:"functional",key:"1",title:"Functional Cookies",description:"These cookies are essential for the website to function properly and cannot be disabled.",required:!0}]},createCategoryElement(category){const categoryEl=document.createElement("div");categoryEl.className="ls-category-item",categoryEl.style.cssText="margin-bottom: 12px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 3px;";const header=document.createElement("div");header.className="ls-category-header",header.style.cssText="display: flex; align-items: center; justify-content: space-between; cursor: pointer;",header.innerHTML=`
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" 
                           id="category-${category.id}" 
                           ${category.required||this.currentConsent[category.key]?"checked":""}
                           ${category.required?"disabled":""}
                           style="margin: 0;">
                    <label for="category-${category.id}" style="margin: 0; font-weight: 500; cursor: pointer;">
                        ${category.title} ${category.required?"(Required)":""}
                    </label>
                </div>
                <button class="ls-toggle-details" 
                        style="background: transparent; border: 1px solid #333; color: #333; 
                               padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;">
                    Details
                </button>
            `,categoryEl.appendChild(header);const details=document.createElement("div");details.className="ls-category-details",details.style.display="none",details.setAttribute("role","region"),details.setAttribute("aria-labelledby",`category-${category.id}-header`);const description=document.createElement("div");description.className="ls-category-description",description.innerHTML=`<p>${category.description}</p>`,details.appendChild(description);const cookiesList=this.createCookiesListForCategory(category.key);return details.appendChild(cookiesList),categoryEl.appendChild(details),this.attachCategoryEventListeners(categoryEl,category),categoryEl},createCookiesListForCategory(categoryKey){const cookiesContainer=document.createElement("div");if(cookiesContainer.className="ls-cookies-list",cookiesContainer.style.cssText="margin-top: 10px;",!this.cookieData)return cookiesContainer.innerHTML="<p>Cookie details loading...</p>",cookiesContainer;const relevantCookies=this.cookieData.filter(cookie=>cookie.values&&cookie.values.category_key===categoryKey);if(0===relevantCookies.length)return cookiesContainer.innerHTML="<p>No cookies found for this category.</p>",cookiesContainer;const cookiesList=document.createElement("ul");return cookiesList.style.cssText="margin: 8px 0 0 0; padding-left: 20px; font-size: 12px; opacity: 0.9;",relevantCookies.slice(0,3).forEach(cookie=>{const listItem=document.createElement("li");listItem.innerHTML=`<strong>${cookie.values.cookie_name}</strong> - ${cookie.values.purpose} (${cookie.values.duration})`,cookiesList.appendChild(listItem)}),relevantCookies.length>3&&(cookiesList.innerHTML+=`<li style="font-style: italic;">...and ${relevantCookies.length-3} more</li>`),cookiesContainer.appendChild(cookiesList),cookiesContainer},attachCategoryEventListeners(categoryEl,category){const toggleBtn=categoryEl.querySelector(".ls-toggle-details"),details=categoryEl.querySelector(".ls-category-details");toggleBtn.addEventListener("click",e=>{e.stopPropagation(),"none"===details.style.display?(details.style.display="block",toggleBtn.textContent="Hide"):(details.style.display="none",toggleBtn.textContent="Details")})},savePreferences(){Utils.log("Saving cookie preferences");const checkboxes=this.categoryContainer.querySelectorAll('input[type="checkbox"]:not([disabled])'),newConsent={};checkboxes.forEach(checkbox=>{const categoryId=checkbox.id.replace("category-",""),categoryKey=this.getCategoryKeyById(categoryId);categoryKey&&(newConsent[categoryKey]=checkbox.checked)}),Object.keys(newConsent).forEach(categoryKey=>{HubSpotAPI.updateConsent(categoryKey,newConsent[categoryKey])}),this.currentConsent=Object.assign({},this.currentConsent,newConsent),this.hideCategoryOptions(),Utils.log("Preferences saved:",newConsent)},getCategoryKeyById(categoryId){const mapping={analytics:"2",marketing:"3",functional:"1"};return mapping[categoryId]},showVerifyBadge(){const badge=document.createElement("div");badge.id="ls-verify-badge",badge.style.cssText=`
                position: fixed;
                top: 10px;
                right: 10px;
                background: #4CAF50;
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
                z-index: 10001;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            `,badge.innerHTML=`
                âœ… VERIFY MODE<br>
                <small>Data: ${this.cookieData?"HubDB":"Embedded"}</small><br>
                <small>Cache: ${CONFIG.cacheVersion}</small>
            `,document.body.appendChild(badge),Utils.log("Verify badge added")}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>OptionAEnhancer.init(),100)}):setTimeout(()=>OptionAEnhancer.init(),100),window.LSRetailOptionA={enhancer:OptionAEnhancer,hubspotAPI:HubSpotAPI,hubDB:HubDBIntegration,utils:Utils,config:CONFIG}}();